function showlocation(o){if("0-0-0"==o||"00-00-00"==o)return"未知";if(""==o)return"";8==o.length&&(o+="-00");var t=o.substring(0,5),e=o.substring(0,2),s=t+"-00-00",a=allArea.province["02-00-00-00"],i="",n="";if("01"==e)return"<span>"+allArea.province["01-00-00-00"][o]+"</span>";if("02-33-00-00"==s||"02-34-00-00"==s)return i=allArea.province["02-00-00-00"][s],"<span>中国</span><span>"+i+"</span>";for(var r in a)s==r&&(i=a[r]);return n=allArea.city[s][o],"<span>"+i+"</span><span>"+n+"</span>"}function showMessage(o){clearTimeout(setM),$(".setting_succeed").html(o).animate({top:0},400,function(){setM=setTimeout(hideMessage,1800)})}function hideMessage(){$(".setting_succeed").animate({top:"-40px"},400)}function filterChars(o){var t=0,e="";if(o.length<6)return o;for(var s=0;s<o.length;s++)if(t+=o.charCodeAt(s)>255?14:7.5,e+=o[s],t>=84)return e+="..";return e}function checkMore(){return 1==sa?photo_count>9*page_no_a||photog_count>11*page_no_a?($(".search_footer").show(),!0):($(".search_footer").hide(),$(".loading").hide(),!1):1==sb?photo_count>12*page_no_b?($(".search_footer").show(),!0):($(".search_footer").hide(),$(".loading").hide(),!1):1==sc&&photog_count>24*page_no_c?($(".search_footer").show(),!0):($(".search_footer").hide(),$(".loading").hide(),!1)}function disAll(){db.hide(),hb.removeClass("title-select"),dc.hide(),hc.removeClass("title-select"),da.fadeIn(400),ha.addClass("title-select"),sa=1,sb=0,sc=0,checkMore()}function disPhotos(){da.hide(),ha.removeClass("title-select"),dc.hide(),hc.removeClass("title-select"),db.fadeIn(400),hb.addClass("title-select"),sb=1,sa=0,sc=0,checkMore()}function disPhotogs(){da.hide(),ha.removeClass("title-select"),db.hide(),hb.removeClass("title-select"),dc.fadeIn(400),hc.addClass("title-select"),sc=1,sa=0,sb=0,checkMore()}function showThisTags(o){for(var t="",e=0;e<o.length;e++)t+='<div><span class="search_data">'+o[e]+'</span><span class="search_ul_remove"><i></i></span></div>';$("#searchlabels").append(t),$("#searchinput").attr("placeholder","")}function doFollow(o){var t=o.getAttribute("data");base.ajax({data:{method:"paiwo.user.follow.follow",follow_id:t},success:function(t){if(0==t.error_id){{o.getAttribute("xs")}2==t.response.follow_state?$(o).removeClass().addClass("photog_added_2").html("<i></i>已关注"):4==t.response.follow_state&&$(o).removeClass().addClass("photog_added_4").html("<i></i>互相关注"),$(o).attr("st",t.response.follow_state),$(o).css({textAlign:"left"})}else{if($(o).css({textAlign:"center"}),40002==t.error_id)return void showMessage("不能关注自己..");showMessage("网络错误..")}},error:function(o){slideMessage("网络错误")}})}function unFollow(o){var t=o.getAttribute("data");base.ajax({data:{method:"paiwo.user.follow.un_follow",follow_id:t},success:function(t){if(0==t.error_id){{o.getAttribute("xs")}$(o).removeClass().addClass("photog_add").html("+ 关注"),$(o).attr("st",t.response.follow_state)}},error:function(o){slideMessage("网络错误")}})}function doLike(o){{var t=o.attr("data");o.attr("path")}base.ajax({data:{method:"http://paiwo.co/static/js/minjs/paiwo.user.like.add",content_id:t,content_type:1},success:function(e){if(0==e.error_id){o.find(".photo_liked").show(),o.find(".photo_fixbox_like").last().removeClass().addClass("photo_fixbox_liked");var s=$(".photo_block[data="+t+"]");s.find(".photo_liked").show(),s.find(".photo_fixbox_like").last().removeClass().addClass("photo_fixbox_liked")}},error:function(o){slideMessage("网络错误")}})}function unLike(o){var t=o.attr("data");base.ajax({data:{method:"paiwo.user.like.delete",content_id:t,content_type:1},success:function(e){if(0==e.error_id){o.find(".photo_liked").hide(),o.find(".photo_fixbox_liked").last().removeClass().addClass("photo_fixbox_like");var s=$(".photo_block[data="+t+"]");s.find(".photo_liked").hide(),s.find(".photo_fixbox_liked").last().removeClass().addClass("photo_fixbox_like")}},error:function(o){slideMessage("网络错误")}})}function doSearch(o){base.ajax({data:{method:"http://paiwo.co/static/js/minjs/paiwo.search.photo.get",tags:o,page_no:1,page_size:12},success:function(o){if(0==o.error_id){photo_count=o.response.count,$("#sear_photo_num").html(photo_count);var t=$.tmpl(tm.photos,o.response.photo_list.slice(0,9)),e=$.tmpl(tm.photos,o.response.photo_list);$("#dbpul").html(e),$("#dapul").html(t),0==o.response.photo_list.length&&($(".search-none").eq(0).show(),$("#noneb").show(),getSomePhoto())}else $(".search-none").eq(0).show(),$("#noneb").show(),getSomePhoto()},error:function(o){slideMessage("网络错误")}})}function searchPhotog(o){base.ajax({data:{method:"http://paiwo.co/static/js/minjs/paiwo.search.user.get",tags:o,page_no:1,page_size:12},success:function(o){if(0==o.error_id){photog_count=o.response.count,$("#sear_photog_num").html(photog_count);var t=$.tmpl(tm.photographers,o.response.user_list.slice(0,6)),e=$.tmpl(tm.photog_detail,o.response.user_list);$("#dcpgul").html(e),$("#dapgul").html(t),0==o.response.user_list.length&&($(".search-none").show(),$("#nonec").show(),getSomePhotog())}else $(".search-none").eq(1).show(),$("#nonec").show(),getSomePhotog()},error:function(o){slideMessage("网络错误")}})}function showMore(){if(1==sa)$(".search_photo").trigger("click");else if(1==sb)pageTwo(++page_no_b);else{if(1!=sc)return;pageThree(++page_no_c)}}function pageTwo(o){base.ajax({data:{method:"http://paiwo.co/static/js/minjs/paiwo.search.photo.get",page_no:o,page_size:12,tags:tags},success:function(o){if(0==o.error_id){var t=$.tmpl(tm.photos,o.response.photo_list);$("#dbpul").append(t),checkMore()}},error:function(o){slideMessage("网络错误")}})}function pageThree(o){base.ajax({data:{method:"http://paiwo.co/static/js/minjs/paiwo.search.user.get",tags:tags,page_no:o,page_size:24},success:function(o){if(0==o.error_id){var t=$.tmpl(tm.photog_detail,o.response.user_list);$("#dcpgul").append(t),checkMore()}},error:function(o){slideMessage("网络错误")}})}function getSomePhoto(){var o=["美女","黑白","人像","少女","制服","和服"];o.sort(function(){return.5-Math.random()}),base.ajax({data:{method:"http://paiwo.co/static/js/minjs/paiwo.search.photo.get",page_no:1,page_size:12,tags:[o[0]]},success:function(o){if(0==o.error_id){o.response.photo_list.sort(function(){return.5-Math.random()});var t=$.tmpl(tm.photos,o.response.photo_list.slice(0,9)),e=$.tmpl(tm.photos,o.response.photo_list);$("#dbpul").html(e),$("#dapul").html(t)}},error:function(o){slideMessage("网络错误")}})}function getSomePhotog(){var o=["小清新","美女","黑白","人像","少女","制服","和服","写真"];o.sort(function(){return.5-Math.random()}),base.ajax({data:{method:"http://paiwo.co/static/js/minjs/paiwo.search.user.get",tags:[o[0]],page_no:1,page_size:12},success:function(o){if(0==o.error_id){o.response.user_list.sort(function(){return.5-Math.random()});var t=$.tmpl(tm.photog_detail,o.response.user_list),e=$.tmpl(tm.photographers,o.response.user_list.slice(0,6));$("#dapgul").append(e),$("#dcpgul").append(t)}},error:function(o){slideMessage("网络错误")}})}function getActivity(o){base.ajax({data:{method:"http://paiwo.co/static/js/minjs/paiwo.search.activity.get",tags:o},success:function(o){if(0==o.error_id){var t=o.response,e="";0!=t.activity_count&&(e=$.tmpl(tm.activity,t),$(".mix_section_activity").append(e).show())}else slideMessage("网络错误")},error:function(o){slideMessage("网络错误")}})}function put_avtivity_state(o){return 1==o?"进行中...":2==o?"即将开始":3==o?"已结束":""}function calcInputWidth(o){var t=document.querySelector(o+" .searchlabels"),e=t.scrollWidth,s=$(o+" .tab_search_ul");e>=750?s.css("margin-left",-(e-650)):s.css("margin-left",0)}function init(){return window.location.search.length<4?($(".search_footer").hide(),$(".search-none").show(),1==is_login,getSomePhoto(),void getSomePhotog()):(tags=decodeURIComponent(window.location.search.slice(3)).split(","),_search.showTab(".search-normal",".search-sim",tags),doSearch(tags),searchPhotog(tags),showThisTags(tags),getActivity(tags),checkMore(),calcInputWidth(".search-sim"),void calcInputWidth(".search-normal"))}function getPhotoId(){var o=window.location.href,t=o.lastIndexOf("/")+1,e=null;if(-1!=o.lastIndexOf("?")){var s=o.lastIndexOf("?");e=o.substring(t,s)}else e=o.substring(t);return e}function testBrowser(){var o=null;return o=Modernizr.csstransforms3d?!0:!1}var tm={};tm.photographers='<li><a class="search_pg_head_img" target="_blank" href="${domain}">{{if avatar == 0}}<img src="user_head-1.gif"/*tpa=http://paiwo.co/static/js/minjs/static/images/user_head.gif*/ width="60" height="60">{{else}}<img src="http://image.paiwo.co/${avatar}" width="60" height="60">{{/if}}</a><dl><dt><a target="_blank" href="${domain}">${filterChars(user_name)}</a></dt><dd>${user_desc}</dd></dl>{{if follow_state == 1}}<a class="photog_add" data="${user_id}" xs="${user_name}" st="${follow_state}">+ 关注</a>{{else follow_state == 2}}<a class="photog_added_2" data="${user_id}" xs="${user_name}" st="${follow_state}"><i></i>已关注</a>{{else follow_state == 3}}<a class="photog_add" data="${user_id}" xs="${user_name}" st="${follow_state}">+ 关注</a>{{else}}<a class="photog_added_4" data="${user_id }" xs="${user_name}" st="${follow_state}"><i></i>互相关注</a>{{/if}}</li>',tm.photos='<li class="photo_block" data="${photo_id}" path="${photo_path}"><img width="280" height="280" src="http://image.paiwo.co/${photo_path}'+base.retinaPixel[280]+'">{{if is_like == true}}<a class="photo_liked photo_fixbox_liked"></a>{{else}}<a class="photo_liked photo_fixbox_liked" style="display:none"></a>{{/if}}<div class="photo_fixbox"><a href="${author_domain}" target="_blank">${author_name}</a>{{if is_like == true}}<button class="photo_fixbox_liked"></button>{{else}}<button class="photo_fixbox_like"></button>{{/if}}</div></li>',tm.photog_detail='<div class="studio-friend-list clearfix"><a class="studio-fri-ava" href="${domain}" target="_blank">{{if avatar == 0}}<img src="http://image.paiwo.co/0">{{else}}<img src="http://image.paiwo.co/${avatar}">{{/if}}</a><div class="studio-fri-info"><div class="studio-fri-iden"><a href="${domain}" target="_blank" class="photog-name">${user_name}</a><i class="undefined"></i></div><div class="studio-fri-place"><span>{{html showlocation(address)}}</span></div><span class="photog_des">${user_desc}</span></div><div class="studio-fri-box">{{if follow_state == 1}}<a class="photog_add" data="${user_id}" xs="${user_name}" st="${follow_state}">+ 关注</a>{{else follow_state == 2}}<a class="photog_added_2" data="${user_id}" xs="${user_name}" st="${follow_state}"><i></i>已关注</a>{{else follow_state == 3}}<a class="photog_add" data="${user_id}" xs="${user_name}" st="${follow_state}">+ 关注</a>{{else}}<a class="photog_added_4" data="${user_id }" xs="${user_name}" st="${follow_state}"><i></i>互相关注</a>{{/if}}<a class="studio-fri-mess" data-code="${user_id}">私信</a></div></div>',tm.activity='<div class="section_activity_box"><a href="${activity_url}" target="_blank"><img src="${activity_banner}"></a><dl><dt><a href="${activity_url}" target="_blank" style="color:#414141;">${activity_title}</a></dt><dd style="display:none;"><span class="activity_span_left"><i></i>${put_avtivity_state(activity_state)}</span><span class="activity_span_right"></span></dd></dl></div>';var setM=null;paiwoPhoto.on("dolikeOut",function(o){var t=$(".photo_block[data="+o+"]");t.find(".photo_liked").show(),t.find(".photo_fixbox_like").removeClass().addClass("photo_fixbox_liked")}),paiwoPhoto.on("unlikeOut",function(o){var t=$(".photo_block[data="+o+"]");t.find(".photo_liked").hide(),t.find(".photo_fixbox_liked").removeClass().addClass("photo_fixbox_like")}),$("#dapgul,#dcpgul").on("mouseenter",".photog_added_2,.photog_added_4",function(){$(this).html("取消").css({textAlign:"center"})}),$("#dapgul,#dcpgul").on("mouseleave",".photog_added_2",function(){$(this).html("<i></i>已关注").css({textAlign:"left"})}),$("#dapgul,#dcpgul").on("mouseleave",".photog_added_4",function(){$(this).html("<i></i>互相关注")});var ha=$(".search_mix"),hb=$(".search_photo"),hc=$(".search_photog_22"),da=$(".search_mix_section"),db=$(".search_photo_section"),dc=$(".search_photog_section"),main=$(".search_main"),sa=1,sb=0,sc=0,collect={};collect.id=0,collect.path="",collect.faid=null;var tags,photo_count=0,photog_count=0,page_no_a=1,page_no_b=1,page_no_c=1;try{var _url=window.location.href;history.pushState({title:"index"},"",_url)}catch(e){}jQuery(function(o){function t(o){for(var t=0;o;)t+=o.offsetTop,o=o.offsetParent;return t}main.on("click",".search_mix",function(){o(".loading").hide(),o(this).hasClass("title-select")||disAll()}),main.on("click",".search_photo",function(){o(this).hasClass("title-select")||disPhotos()}),main.on("click",".search_photog_22",function(){o(this).hasClass("title-select")||disPhotogs()}),main.on("click",".studio-fri-mess",function(){return console.log(1),0==is_login?(console.log(1),void loginInside.show()):(o("#top_message").trigger("click"),void PWS.addTalk(this.getAttribute("data-code")))}),main.on("click",".photog_add",function(){var t=o(this).attr("st");if(0==is_login)loginInside.show();else switch(t){case"1":doFollow(this);break;case"3":doFollow(this)}}),main.on("click",".photog_added_2,.photog_added_4",function(){var t=o(this).attr("st");if(o(this).css({textAlign:"center"}),0==is_login)loginInside.show();else switch(t){case"2":unFollow(this);break;case"4":unFollow(this)}}),main.on("click",".photo_fixbox_like",function(t){return 0==is_login?(loginInside.show(),!1):(t.stopPropagation(),void doLike(o(this).parents(".photo_block")))}),main.on("click",".photo_fixbox_liked",function(t){t.stopPropagation(),unLike(o(this).parents(".photo_block"))}),main.on("mouseenter",".photo_block",function(){o(this).find(".photo_fixbox").animate({bottom:"0"},100,"linear")}),main.on("mouseleave",".photo_block",function(){o(this).find(".photo_fixbox").animate({bottom:"-36px"},100,"linear")}),o(".dou_section_ul").on("mouseenter","li",function(){o(this).find(".photo_fixbox_big").animate({bottom:"0"},100,"linear")}),o(".dou_section_ul").on("mouseleave","li",function(){o(this).find(".photo_fixbox_big").animate({bottom:"-36px"},100,"linear")}),main.on("click",".search_showall2",function(){o(".search_photog_22").trigger("click")}),main.on("click",".photo_fixbox_dinged",function(t){t.stopPropagation();var e=o(this).parents(".photo_block").attr("data");unCollect(e)}),main.on("click",".photo_fixbox_ding",function(t){if(0==is_login)return loginInside.show(),!1;t.stopPropagation();var e=o(this).parents(".photo_block"),s=e.attr("path"),a=e.attr("data");o(".store_album_img").attr("src","http://image.paiwo.co/"+s+"@!280x280"),o("#collect-back").fadeIn(100),paiwoPhoto.data.photo_id=a}),main.on("click",".search_footer",function(){checkMore()&&showMore()}),window.onload=window.onscroll=function(){var e=document.documentElement.clientHeight+(document.documentElement.scrollTop||document.body.scrollTop),s=main[0].scrollHeight+t(main[0]);"none"==o(".search_mix_section").css("display")&&e-70>s&&checkMore()&&(o(".loading").show(),showMore())},main.on("click",".photo_block",function(){var o=this.getAttribute("data");history.pushState&&history.pushState({title:"show"},"","/photos/"+o),paiwoPhoto.init(o),paiwoPhoto.trg("showpic"),paiwoPhoto.tool.scrollShow()}),main.on("click",".photo_fixbox>a",function(o){o.stopPropagation()}),init()}),history.pushState&&window.addEventListener("popstate",function(o){var t=window.location.href,e=document.getElementsByTagName("body")[0],s=paiwoPhoto.tool.scrollbarwidth;if(/search?/.test(t))$(".black_bac").hide(),e.style.overflow="auto",e.style.paddingRight="0px";else if(/photos/.test(t)){var a=getPhotoId();paiwoPhoto.init(a),$(".black_bac").show(),paiwoPhoto.trg("showpic"),e.style.overflow="hidden",e.style.paddingRight=s+"px"}}),searchModule(".search-sim"),searchModule(".search-normal");var _search={scroll_old:0,isTransforms:testBrowser(),showTab:function(o,t,e){if(e.length){$(o+" .search_input").attr("placeholder",""),$(t+" .search_input").attr("placeholder","");for(var s="",a=0;a<e.length;a++)s+='<div class="search-color'+_search.rndColor(1,11)+'"><span class="search_data">'+e[a]+'</span><span class="search_ul_remove"><i></i></span></div>';$(o+" .searchlabels").append(s),$(t+" .searchlabels").append(s)}},rndColor:function(o,t){return parseInt(Math.random()*(t-o))+o},findRe:function(o,t){return o==t?!1:void 0}};window.addEventListener("scroll",function(){var o=document.documentElement.scrollTop||document.body.scrollTop;_search.isTransforms?o>90?($(".search-sim").addClass("active"),$(".push_button").css("background-color","#ff475c")):($(".search-sim").removeClass("active"),$(".push_button").css("background-color","#2e2e2e")):o>90?($(".search-sim").stop().animate({top:"40px",opacity:1},200,"linear"),$(".push_button").css("background-color","#ff475c")):($(".search-sim").stop().animate({top:"-120px",opacity:0},200,"linear"),$(".push_button").css("background-color","#2e2e2e"))},!1),window.addEventListener("scroll",function(){var o=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.clientHeight||document.body.clientHeight;o>t/2?$("#go_top").stop(!0,!0).fadeIn():$("#go_top").stop(!0,!0).fadeOut()},!1),$("#go_top").on("click",function(){$("html,body").stop().animate({scrollTop:0},600)});