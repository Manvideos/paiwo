function checkCollect(){$(".store_album_select li").length>0?($(".store_album_input_none").hide(),$(".store_album_input").show()):($(".store_album_input_none").show(),$(".store_album_input").hide())}function checkSelect(){"请选择一个收藏夹"==$(".store_album_input").html()?$("#store_btn").removeClass().addClass("gray_submit"):$("#store_btn").removeClass().addClass("store_button_submit").addClass("submit")}function check_navi(){var t=document.documentElement.clientWidth;if($(".top-tab-con").css("width","300px"),$(".top-tab").css("margin-left","0px"),t>=1658){var o=(t-100-1400-60)/2;return void $(".top-tab-con").css("margin-right",o+"px")}if(1658>t&&t>=1347){var o=(t-100-1120-45)/2;$(".top-tab-con").css("margin-right",o+"px")}else if(1347>t&&t>=1035){var o=(t-100-840-30)/2;$(".top-tab-con").css("margin-right",o+"px")}else if(1035>t){var o=(t-100-560-15)/2;$(".top-tab-con").css("margin-right",o+"px")}}function isLike(t){return 1==t?"photo_fixbox_liked":"photo_fixbox_like"}function isFavorite(t){return 1==t?"photo_fixbox_dinged":"photo_fixbox_ding"}function islogin(){return 0==is_login?(window.location.href="index.htm"/*tpa=http://paiwo.co/*/,!1):!0}function addwheel(t,o){function e(t){var e=t||event,a=!1;return a=e.wheelDelta?e.wheelDelta<0?!0:!1:e.detail>0?!0:!1,o&&o(a),bScroll?!0:(e.preventDefault&&e.preventDefault(),!1)}-1!=window.navigator.userAgent.toLowerCase().indexOf("firefox")?t.addEventListener("DOMMouseScroll",e,!1):t.onmousewheel=e}function addCookie(t,o,e){var a=new Date;a.setDate(a.getDate()+e),document.cookie=t+"="+o+";path=/;expires="+a.toGMTString()}function getCookie(t){for(var o=document.cookie.split("; "),e=0;e<o.length;e++){var a=o[e].split("=");if(a[0]==t)return a[1]}return""}function removeCookie(t){addCookie(t,"1",-1)}function showMessage(t){clearTimeout(setM),$(".message-box").html(t).animate({top:0},400,function(){setM=setTimeout(hideMessage,1500)})}function hideMessage(){$(".message-box").animate({top:"-52px"},400)}function getPos(t){for(var o=0,e=0;t;)o+=t.offsetLeft,e+=t.offsetTop,t=t.offsetParent;return{left:o,top:e}}function get_photo_count(){base.ajax({data:{method:"http://paiwo.co/static/js/minjs/paiwo.gallery.collection_count.get"},success:function(t){0==t.error_id?photo_count=t.response.count:slideMessage("网络错误..")},error:function(t){slideMessage("网络错误")}})}function get_first_photo(){function t(){function t(t,o){return parseInt(Math.random()*(o-t))+t}function o(t,o){for(var e=0;e<t.length;e++)if(t[e]==o)return!0;return!1}function e(){for(;a.length<20;){var e=photo_num_arr.length,i=t(1,e+1)-1;o(a,photo_num_arr[i])||(a.push(photo_num_arr[i]),photo_num_arr.splice(i,1))}}var a=[];return e(),a.join(",")}var t=t();base.ajax({data:{method:"http://paiwo.co/static/js/minjs/paiwo.gallery.collection.get",random_list:t.split(",")},success:function(t){if(0==t.error_id)for(var o=t.response.photo_list.sort(function(){return.5-Math.random()}),e=0,a=$(".photos-list").eq(0).children(),i=0;i<o.length;i++){var s=new Image,l=is_photo_url(o[i].photo_path);a[i].setAttribute("data",o[i].photo_id),a[i].getElementsByTagName("img")[0].src=l;var n=$.tmpl(photo_info_tm,o[i]);jQuery(a[i]).append(n),s.src=l,s.onload=function(){e++,e==o.length?(b_first_load=!0,b_img_load=!0,$(".loading").hide(),$(".photo_fixbox").show()):(b_first_load=!1,b_img_load=!1,$(".loading").show(),$(".photo_fixbox").hide())},s.onerror=function(){e++,e==o.length?(b_first_load=!0,b_img_load=!0,$(".loading").hide(),$(".photo_fixbox").show()):(b_first_load=!1,b_img_load=!1,$(".loading").show(),$(".photo_fixbox").hide())}}else showMessage("网络错误")},error:function(t){slideMessage("网络错误")}})}function get_photo_list(){function t(){function t(t,o){return parseInt(Math.random()*(o-t))+t}function o(t,o){for(var e=0;e<t.length;e++)if(t[e]==o)return!0;return!1}function e(){var e=photo_num_arr.length;if(20>=e){for(end_load=!1;a.length<e;){e=photo_num_arr.length;var i=t(1,e+1)-1;o(a,photo_num_arr[i])||(a.push(photo_num_arr[i]),photo_num_arr.splice(i,1))}$(".pg_list_foot").show()}else for(;a.length<20;){e=photo_num_arr.length;var i=t(1,e+1)-1;o(a,photo_num_arr[i])||(a.push(photo_num_arr[i]),photo_num_arr.splice(i,1))}}var a=[];return e(),a.join(",")}var t=t();base.ajax({data:{method:"http://paiwo.co/static/js/minjs/paiwo.gallery.collection.get",random_list:t.split(",")},success:show_photo,error:function(t){slideMessage("网络错误")}})}function getHot(t){base.ajax({data:{method:"http://paiwo.co/static/js/minjs/paiwo.gallery.hot.get",page_no:t,page_size:20},success:function(t){if(0==t.error_id)for(var o=t.response.photo_list.sort(function(){return.5-Math.random()}),e=0,a=0;a<o.length;a++){var i=new Image,s=is_photo_url(o[a].photo_path);i.src=s,i.onload=function(){if(e++,e==o.length){b_img_load=!0;var t=$.tmpl(photo_tm,o);$(".photos-list-hot").append(t),$(".loading").hide()}else b_img_load=!1,$(".loading").show()},i.onerror=function(){if(e++,e==o.length){b_img_load=!0;var t=$.tmpl(photo_tm,o);$(".photos-list-hot").append(t),$(".loading").hide()}else b_img_load=!1,$(".loading").show()}}else showMessage("网络错误")},error:function(t){slideMessage("网络错误")}})}function getNew(t){base.ajax({data:{method:"http://paiwo.co/static/js/minjs/paiwo.gallery.new.get",page_no:t,page_size:20},success:function(t){if(0==t.error_id)for(var o=t.response.photo_list.sort(function(){return.5-Math.random()}),e=0,a=0;a<o.length;a++){var i=new Image,s=is_photo_url(o[a].photo_path);i.src=s,i.onload=function(){if(e++,e==o.length){b_img_load=!0;var t=$.tmpl(photo_tm,o);$(".photos-list-new").append(t),$(".loading").hide()}else b_img_load=!1,$(".loading").show()},i.onerror=function(){if(e++,e==o.length){b_img_load=!0;var t=$.tmpl(photo_tm,o);$(".photos-list-new").append(t),$(".loading").hide()}else b_img_load=!1,$(".loading").show()}}else showMessage("网络错误")},error:function(t){slideMessage("网络错误")}})}function is_photo_url(t){var o="";return o=""!=t?"http://image.paiwo.co/"+t+base.retinaPixel[280]:"pic-deleted.png"/*tpa=http://paiwo.co/static/images/pic-deleted.png*/}function show_photo(t){if(0==t.error_id)for(var o=t.response.photo_list.sort(function(){return.5-Math.random()}),e=0,a=0;a<o.length;a++){var i=new Image,s=is_photo_url(o[a].photo_path);i.src=s,i.onload=function(){if(e++,e==o.length){b_img_load=!0;var t=$.tmpl(photo_tm,o);$(".photos-list").eq(0).append(t),$(".loading").hide()}else b_img_load=!1,$(".loading").show()},i.onerror=function(){if(e++,e==o.length){b_img_load=!0;var t=$.tmpl(photo_tm,o);$(".photos-list").eq(0).append(t),$(".loading").hide()}else b_img_load=!1,$(".loading").show()}}else showMessage("网络错误")}function getPos(t){for(var o=0,e=0;t;)o+=t.offsetLeft,e+=t.offsetTop,t=t.offsetParent;return{left:o,top:e}}function addcollect_result(t){if(0==t.error_id){var o='<li class="store_select_li_cur" data="'+t.result.favorite_id+'">'+t.result.favorite_name+"</li>",e=$(".store_album_select");$(".store_select_text").val(""),$(".store_album_select li").removeClass("store_select_li_cur"),e.append(o);var a=$(".store_album_input");a.attr("data",t.result.favorite_id),a.text(t.result.favorite_name),checkCollect(),checkSelect(),$(".store_album_select button").removeClass("store_select_button").addClass("store_select_button_none")}else showMessage("网络错误")}function getCollect(){$.ajax({url:"/a/photo/favorite/name/list",type:"POST",dataType:"json",success:getCollect_result})}function getCollect_result(t){if(0==t.error_id)if(0==t.result.favorite_list.length)$(".store_album_input_none").show(),$(".store_album_input").hide(),$(".store_button_submit").removeClass("store_button_submit").addClass("store_button_submit_none"),has_collect=0;else{var o=help.collectlist(t.result.favorite_list);$(".store_album_select").append(o),$(".store_album_input").show(),$(".store_album_input_none").hide(),has_collect=1}else showMessage("网络错误")}function jq_ajax(t,o,e,a,i,s){$.ajax({type:e,dataType:"json",url:t,data:o,success:a,async:i,error:s})}function doSearch(t,o,e){base.ajax({data:{method:"http://paiwo.co/static/js/minjs/paiwo.search.photo.get",tags:t,page_no:o,page_size:20},success:function(t){if(0==t.error_id){photo_count=t.response.count;var a=t.response.photo_list.sort(function(){return.5-Math.random()}),i=0,s=parseInt(photo_count/20),l=!1,n=null,r=!0;o>=s&&(b_img_load=!1,$(".loading").hide());for(var c=0;c<a.length;c++){var d=new Image,h=is_photo_url(a[c].photo_path);d.src=h,d.onload=function(){if(i++,r)if(i==a.length){clearTimeout(n),b_img_load=!0,$(".loading").hide();var t=$.tmpl(search_tm,a);$(".photos-list").eq(e).append(t)}else b_img_load=!1,$(".loading").show()}}n=setTimeout(function(){b_img_load=!0,l=!0,$(".loading").hide(),$("html").css("padding-right",0);var t=$.tmpl(search_tm,a);$(".photos-list").eq(e).append(t),console.log(1),r=!1},5e3)}},error:function(t){slideMessage("网络错误")}})}function getPhotoId(){var t=window.location.href,o=t.lastIndexOf("/")+1,e=null;if(-1!=t.lastIndexOf("?")){var a=t.lastIndexOf("?");e=t.substring(o,a)}else e=t.substring(o);return e}var photo_tm='<div data="${photo_id}" class="photo-data"><a class="photo" href="javascript:;"><img style="width:280px;height:280px"src="${is_photo_url(photo_path)}" class="photo-img"/></a><i class="inner_liked_img"></i><p class="photo_fixbox"><a href="http://paiwo.co/${author_domain}" target="_blank">${author_name}</a><button class="${isLike(is_like)}" data="${photo_id}" path="${photo_path}"></button></p></div>',photo_info_tm='<p class="photo_fixbox"><a href="${author_domain}" target="_blank">${author_name}</a><button class="${isLike(is_like)}" data="${photo_id}" path="${photo_path}"></button></p>',has_collect=0,search_tm='<div data="${photo_id}" class="photo-data"><a class="photo" href="javascript:;"><img style="width:280px;height:280px"src="${is_photo_url(photo_path)}" class="photo-img"/></a><i class="inner_liked_img"></i><p class="photo_fixbox"><a href="${author_domain}" target="_blank">${author_name}</a><button class="${isLike(is_like)}" data="${photo_id}" path="${photo_path}"></button></p></div>',help={collect:function(t){return"1"==t?"collected20.png"/*tpa=http://paiwo.co/static/js/minjs/collected20.png*/:"collect20.png"/*tpa=http://paiwo.co/static/js/minjs/collect20.png*/},like:function(t){return"1"==t?"liked20.png"/*tpa=http://paiwo.co/static/js/minjs/liked20.png*/:"like20.png"/*tpa=http://paiwo.co/static/js/minjs/like20.png*/},collectlist:function(t){for(var o="",e=0;e<t.length;e++)if(1==t[e].is_default){o+='<li class="store_select_li_cur" data="'+t[e].favorite_id+'">'+t[e].favorite_name+"</li>";var a=$(".store_album_input");a.text(t[e].favorite_name),a.attr("data",t[e].favorite_id)}else o+='<li data="'+t[e].favorite_id+'">'+t[e].favorite_name+"</li>";return o}},setM,page_sg_count=30,is_winsrcoll=!1,b_sel_open=!1,photo_num_arr=[],photo_count=0,b_img_load=!1,b_first_load=!1,end_load=!0,page_no=[0,0,0,0,0,0,0,0,0,0],tags_flag=!0,tags=[],nowTag=null,tagIndex=0,data=[0],list=[],page=0,cur=0,photo_count=0;get_photo_count();for(var i=1;photo_count>=i;i++)photo_num_arr.push(i);get_first_photo(),window.addEventListener("scroll",function(){{var t=($(".photo-data").get(0),document.getElementsByClassName("photo-img"),$(".photos-list").eq(tagIndex+1).get(0)),o=document.documentElement.clientHeight,e=document.documentElement.scrollTop||document.body.scrollTop,a=e+o;document.getElementsByTagName("body")[0]}a>=getPos(t).top+t.scrollHeight-600&&b_img_load&&b_first_load&&end_load&&(b_img_load=!1,$(".loading").show(),tags_flag?$(".gallery-cla-rec").hasClass("classify-txt-cur")?get_photo_list():$(".gallery-cla-hot").hasClass("classify-txt-cur")?getHot(++hot_no):$(".gallery-cla-new").hasClass("classify-txt-cur")&&getNew(++new_no):doSearch(tags,++page_no[tagIndex],tagIndex+1))},!1);var now_id=null;jQuery(function(t){var o=t(".photos"),e=window.location.href,a={title:"gallery",url:"/gallery"};window.history.replaceState&&window.history.replaceState(a,"",e),o.on("click",".photo_fixbox_ding",function(o){if(o.stopPropagation(),0==is_login)return void loginInside.show();var e=this.getAttribute("data"),a=this.getAttribute("path");return""==a?void showMessage("图片已被删除"):(t(".store_album_img").attr("src","http://image.paiwo.co/"+a+"@!280x280"),t("#collect-back").fadeIn(100),void(paiwoPhoto.data.photo_id=e))}),o.on("click",".photo_fixbox_dinged",function(o){o.stopPropagation();var e=this.getAttribute("data");t.ajax({url:"/a/photo/favorite/unfavorite",type:"POST",dataType:"json",data:{photo_id:e},success:function(o){t(".photo_fixbox_dinged[data="+e+"]").removeClass().addClass("photo_fixbox_ding")}})}),t(".store_box").on("click",".store_select_button",function(o){function e(t){for(var o=0,e=/[\u4e00-\u9fa5]/,a=0;a<t.length;a++)e.test(t.charAt(a))?o+=2:o++;return o}var a=t(".store_select_text").val();e(a)<=30?t.ajax({url:"/a/photo/favorite/add",type:"POST",dataType:"json",data:{favorite_name:a},success:addcollect_result}):showMessage("名称过长，请重新填写")}),t(".store_box").on("click",".store_button_submit",function(o){o.preventDefault();var e=t(".store_album_img"),a=t(".store_album_input").attr("data"),i=e.attr("data"),s=e.attr("path"),l=t(".photo-data[id="+i+"]").find(".photo_fixbox>a").html();null==l&&(l=t(".username").html()),""!=a&&void 0!=a&&(t.ajax({url:"/a/photo/favorite/dofavorite",type:"POST",dataType:"json",data:{favorite_id:a,photo_id:i,photo_path:s},success:function(o){if(0==o.error_id){t('.photo_fixbox_ding[data="'+i+'"]').removeClass().addClass("photo_fixbox_dinged");var e=t(".tab_buttons_right");e.addClass("select-s"),e.css({background:"#414141"}),e.find("i").addClass("favorite-select"),e.find("span").css({color:"#fff"})}}}),t(".store_button_cancel").trigger("click"))}),o.on("click",".photo_fixbox_like",function(o){if(o.stopPropagation(),0==is_login)return void loginInside.show();{var e=this.getAttribute("data"),a=this.getAttribute("path");t(".photo-data[id="+e+"]").find(".photo_fixbox>a").html()}return""==a?void showMessage("图片已被删除"):void base.ajax({data:{method:"http://paiwo.co/static/js/minjs/paiwo.user.like.add",content_id:e,content_type:1},success:function(o){0==o.error_id&&t(".photo_fixbox_like[data="+e+"]").removeClass().addClass("photo_fixbox_liked")},error:function(t){slideMessage("网络错误")}})}),o.on("click",".photo_fixbox_liked",function(o){if(o.stopPropagation(),0!=is_login){var e=this.getAttribute("data");base.ajax({data:{method:"paiwo.user.like.delete",content_id:e,content_type:1},success:function(o){0==o.error_id&&t(".photo_fixbox_liked[data="+e+"]").removeClass().addClass("photo_fixbox_like")},error:function(t){slideMessage("网络错误")}})}}),o.on("mouseenter",".photo-data",function(o){t(this).find(".photo_fixbox").stop().animate({bottom:"0px"},100)}),o.on("mouseleave",".photo-data",function(o){t(this).find(".photo_fixbox").stop().animate({bottom:"-36px"},100)}),t(".main_content").on("click",".photo-data",function(t){var o=this.getElementsByTagName("img")[0].getAttribute("src");if("pic-deleted.png"/*tpa=http://paiwo.co/static/images/pic-deleted.png*/==o)return void showMessage("该照片已被原作者删除");var e=this.getAttribute("data");return paiwoPhoto.init(e),paiwoPhoto.trg("showpic"),paiwoPhoto.tool.scrollShow(),!1}),window.addEventListener("scroll",function(){var o=document.documentElement.scrollTop||document.body.scrollTop;0==o?t("#go_top").fadeOut():t("#go_top").fadeIn()},!1),t("#go_top").on("click",function(){t("html,body").stop().animate({scrollTop:0},600)}),paiwoPhoto.on("dolikeOut",function(o){t(".photo_fixbox_like[data="+o+"]").removeClass().addClass("photo_fixbox_liked")}),paiwoPhoto.on("unlikeOut",function(o){t(".photo_fixbox_liked[data="+o+"]").removeClass().addClass("photo_fixbox_like")}),paiwoPhoto.on("unfavoriteOut",function(o){t(".photo_fixbox_dinged[data="+o+"]").removeClass().addClass("photo_fixbox_ding")}),paiwoPhoto.on("dofavoriteOut",function(o){t(".photo_fixbox_ding[data="+o+"]").removeClass().addClass("photo_fixbox_dinged")}),t(".main_content").on("click",".photo_fixbox",function(t){t.stopPropagation()})}),$(".gallery-classify-pic a").click(function(){$(".gallery-classify-txt li").removeClass("classify-txt-cur"),$(".gallery-classify-pic i").fadeOut(100),$(this).find("i").fadeIn(100)});var classifyOld=0,classifyNew=0;$(".gallery-classify-pic a").mouseenter(function(){$(".gallery-classify-hover").css("display","block"),classifyNew=classifyNew,classifyOld=$($(".gallery-classify-pic a")).index($(this));var t=148*parseInt((classifyOld-classifyNew)/2)+147.5*(classifyOld-classifyNew-parseInt((classifyOld-classifyNew)/2));$(".gallery-classify-hover").css({"-webkit-transform":"translateX("+t+"px)","-webkit-transition":"all 200ms linear","-moz-transform":"translateX("+t+"px)","-moz-transition":"all 200ms linear","-ms-transform":"translateX("+t+"px)","-ms-transition":"all 200ms linear","-o-transform":"translateX("+t+"px)","-o-transition":"all 200ms linear",transform:"translateX("+t+"px)",transition:"all 200ms linear"})}),$(".gallery-classify-pic").mouseleave(function(){$(".gallery-classify-hover").hide()}),$(".gallery-classify-pic a").click(function(){nowTag=$(this).attr("class"),tags=[],tagIndex=$(".gallery-classify-pic a").index($(this));for(var t=$(this).find("dd"),o=0;o<t.length;o++)tags[o]=t[o].innerHTML;$(".photos-list").hide(),$(".photos-list").eq(tagIndex+1).show(),0==$(".photos-list").eq(tagIndex+1).children().length&&(page_no[tagIndex]=1,doSearch(tags,1,tagIndex+1)),tags_flag=!1}),$(".gallery-cla-rec").click(function(){$(this).hasClass("classify-txt-cur")||($(this).addClass("classify-txt-cur").siblings().removeClass("classify-txt-cur"),$(".photos-list").hide(),$(".photos-list").eq(0).show(),tags_flag=!0,$(".gallery-classify-pic i").hide())}),$(".gallery-cla-hot").click(function(){$(this).hasClass("classify-txt-cur")||($(this).addClass("classify-txt-cur").siblings().removeClass("classify-txt-cur"),$(".photos-list").hide(),$(".photos-list-hot").show(),tags_flag=!0,$(".gallery-classify-pic i").hide(),0==$(".photos-list-hot").children().length&&(hot_no=1,getHot(1)))}),$(".gallery-cla-new").click(function(){$(this).hasClass("classify-txt-cur")||($(this).addClass("classify-txt-cur").siblings().removeClass("classify-txt-cur"),$(".photos-list").hide(),$(".photos-list-new").show(),tags_flag=!0,$(".gallery-classify-pic i").hide(),0==$(".photos-list-new").children().length&&(new_no=1,getNew(1)))}),function(){var t=store.get("tag");switch(t){case"1":$(".gallery-classify-part1").find("i").show(),$(".gallery-classify-pic a").eq(0).trigger("click"),store.remove("tag");break;case"2":$(".gallery-classify-part2").find("i").show(),$(".gallery-classify-pic a").eq(1).trigger("click"),store.remove("tag");break;case"3":$(".gallery-classify-part3").find("i").show(),$(".gallery-classify-pic a").eq(2).trigger("click"),store.remove("tag");break;case"4":$(".gallery-classify-part4").find("i").show(),$(".gallery-classify-pic a").eq(3).trigger("click"),store.remove("tag");break;case"5":$(".gallery-classify-part5").find("i").show(),$(".gallery-classify-pic a").eq(4).trigger("click"),store.remove("tag");break;case"6":$(".gallery-classify-part6").find("i").show(),$(".gallery-classify-pic a").eq(5).trigger("click"),store.remove("tag");break;case"7":$(".gallery-classify-part7").find("i").show(),$(".gallery-classify-pic a").eq(6).trigger("click"),store.remove("tag");break;case"8":$(".gallery-classify-part8").find("i").show(),$(".gallery-classify-pic a").eq(7).trigger("click"),store.remove("tag")}if(store.has("index_from")){var o=store.get("index_from").toString();"1"==o?$(".gallery-cla-rec").trigger("click"):"2"==o?$(".gallery-cla-hot").trigger("click"):"3"==o&&$(".gallery-cla-new").trigger("click"),store.remove("index_from")}}(),history.pushState&&window.addEventListener("popstate",function(t){var o=(window.location.href,document.getElementsByTagName("body")[0]),e=paiwoPhoto.tool.scrollbarwidth;if("gallery"==t.state.title)$(".black_bac").hide(),o.style.overflow="auto",o.style.paddingRight="0px";else if("show"==t.state.title){var a=getPhotoId();paiwoPhoto.init(a),$(".black_bac").show(),paiwoPhoto.trg("showpic"),o.style.overflow="hidden",o.style.paddingRight=e+"px"}});